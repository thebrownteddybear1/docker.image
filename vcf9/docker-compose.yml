version: '3.8'

services:
  vcf-manager:
    build: .
    container_name: vcf-v9-manager
    hostname: depot.vcf-gcp.broadcom.net
    
    # Required for OpenConnect VPN to create the 'tun' interface
    privileged: true
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"

    ports:
      - "2222:22"   # Maps SSH to port 2222 to avoid conflict with host SSH
      - "80:80"     # HTTP for Depot
      - "443:443"   # HTTPS for Depot

    volumes:
      # This ensures downloaded VCF bundles persist on your host machine
      - ./depot_data:/depot
      # Optional: persist your git repo and scripts
      - ./root_data:/root/tonjiak
      # Persistent logs for the token script
      - ./powershell_logs:/depot/vcf-download-tool/logs

    environment:
      # These can override the Dockerfile defaults if needed
      - DepotTier=Staging
      - ProductionUserEmail=svc.config-infra@broadcom.com

    restart: unless-stopped
    stdin_open: true
    tty: true

networks:
  default:
    name: vcf_network